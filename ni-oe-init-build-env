TEMPLATECONF=${TEMPLATECONF:-$PWD/sources/meta-nilrt/conf}
BITBAKEDIR=${BITBAKEDIR:-$PWD/sources/bitbake}
BUILDDIR=${BUILDDIR:-$PWD/build}
BB_ENV_EXTRAWHITE=${BB_ENV_EXTRAWHITE:-BUILD_IDENTIFIER ENABLE_BUILD_TAG_PUSH}

if [ ! -f $BUILDDIR/conf/bblayers.conf ]; then
    sed -i "s?##PWD##?$PWD?g" $TEMPLATECONF/bblayers.conf.sample
fi

function cleanup() {
    pushd $TEMPLATECONF
    git checkout bblayers.conf.sample
    popd
}

trap "cleanup >/dev/null 2>&1" EXIT

export PS1="(bb) $PS1"
export TEMPLATECONF
source $PWD/sources/openembedded-core/oe-init-build-env

cleanup >/dev/null 2>&1
